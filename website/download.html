<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>QNote — Downloads</title>
    <meta name="description" content="Download QNote releases: small, fast, open-source notepad replacement for Windows. No telemetry, minimal footprint.">
    <meta name="keywords" content="QNote download, notepad download, windows text editor, releases">
    <meta name="author" content="Cooper Ransom">
    <meta name="robots" content="index,follow">
    <meta name="theme-color" content="#ffffff">

    <meta property="og:site_name" content="QNote">
    <meta property="og:title" content="QNote — Downloads">
    <meta property="og:description" content="Download QNote releases: small, fast, open-source notepad replacement for Windows.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://qnote.ar0.eu/download.html">
    <meta property="og:image" content="https://qnote.ar0.eu/assets/header.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@QNoteApp">
    <meta name="twitter:title" content="QNote — Downloads">
    <meta name="twitter:description" content="Download QNote releases: small, fast, open-source notepad replacement for Windows.">
    <meta name="twitter:image" content="https://qnote.ar0.eu/assets/header.jpg">

    <link rel="canonical" href="https://qnote.ar0.eu/download.html">
    <link rel="icon" href="assets/icon.svg" type="image/svg+xml" />
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <meta name="github-repo" content="itzcozi/qnote" />

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "QNote",
      "description": "Download QNote releases: a small, fast, open-source notepad replacement for Windows.",
      "operatingSystem": "Windows",
      "applicationCategory": "DesktopApplication",
      "url": "https://qnote.ar0.eu/download.html",
      "image": "https://qnote.ar0.eu/assets/header.jpg"
    }
    </script>
  </head>

  <body>
    <h1>Downloads</h1>

    <nav class="site-links" aria-label="Main navigation">
      <a href="index.html" title="QNote home page">Home</a>
      <a href="source.html" title="View QNote source code on GitHub">Source</a>
      <a href="more.html" title="Learn more about QNote">Learn more</a>
    </nav>

    <div id="releases">Loading releases...</div>

    <script>
      (function () {
        const container = document.getElementById("releases");

        function getRepoFromMeta() {
          const m = document.querySelector('meta[name="github-repo"]');
          return m && m.content ? m.content.trim() : null;
        }

        const repo = getRepoFromMeta();

        if (!repo) {
          container.innerHTML = `No GitHub repo configured. Add a meta tag <meta name="github-repo" content="owner/repo"> to the document <head>.`;
          return;
        }

        const [owner, repoName] = repo.split("/");
        const apiUrl = `https://api.github.com/repos/${owner}/${repoName}/releases?per_page=5`;

        function fmtDate(iso) {
          try {
            return new Date(iso).toLocaleString();
          } catch (e) {
            return iso;
          }
        }

        function createLink(href, text, target = null) {
          const a = document.createElement("a");
          a.href = href;
          a.textContent = text;
          if (target) {
            a.target = target;
          }
          return a;
        }

        fetch(apiUrl)
          .then((resp) => {
            if (!resp.ok) throw new Error(`GitHub API error: ${resp.status}`);
            return resp.json();
          })
          .then((releases) => {
            if (!Array.isArray(releases) || releases.length === 0) {
              container.innerHTML = "No releases found.";
              return;
            }

            const list = document.createElement("div");
            list.className = "releases-list";

            releases.forEach((rel) => {
              const card = document.createElement("article");
              card.className = "release";

              const h2 = document.createElement("h2");
              h2.textContent = rel.name || rel.tag_name || "Unnamed release";
              card.appendChild(h2);

              const meta = document.createElement("div");
              meta.className = "release-meta";
              meta.textContent = `Published: ${fmtDate(rel.published_at || rel.created_at || "")}`;
              card.appendChild(meta);

              let wrapper;
              const isLong = rel.body && rel.body.length > 600;

              if (rel.body) {
                const CHAR_LIMIT = 600;

                wrapper = document.createElement("div");
                wrapper.className = "release-notes";

                const fullHtml = marked.parse(rel.body);
                const truncatedHtml = marked.parse(rel.body.slice(0, CHAR_LIMIT) + "…");

                wrapper.innerHTML = isLong ? truncatedHtml : fullHtml;

                if (isLong) {
                  wrapper.classList.add("collapsed");
                  const toggle = document.createElement("button");
                  toggle.className = "show-more-btn";
                  toggle.textContent = "Show more";
                  toggle.addEventListener("click", function () {
                    wrapper.innerHTML = fullHtml;
                    wrapper.classList.remove("collapsed");
                    assets.insertBefore(ghLink, assets.firstChild);
                  });
                  wrapper.appendChild(toggle);
                }

                card.appendChild(wrapper);
              }

              const assets = document.createElement("div");
              assets.className = "release-assets";

              const relUrl =
                rel.html_url ||
                `https://github.com/${owner}/${repoName}/releases/tag/${rel.tag_name}`;
              const ghLink = createLink(relUrl, "View release on GitHub", "_blank");

              if (!isLong) {
                assets.insertBefore(ghLink, assets.firstChild);
              }

              if (Array.isArray(rel.assets) && rel.assets.length) {
                const dlHeader = document.createElement("h3");
                dlHeader.textContent = "Downloads:";
                assets.appendChild(dlHeader);

                const ul = document.createElement("ul");
                ul.className = "asset-list";
                rel.assets.forEach((a) => {
                  const li = document.createElement("li");
                  const size = a.size ? ` (${(a.size / 1024).toFixed(1)} KB)` : "";
                  const link = createLink(
                    a.browser_download_url || a.url,
                    a.name + size
                  );
                  li.appendChild(link);
                  ul.appendChild(li);
                });
                assets.appendChild(ul);
              }

              card.appendChild(assets);
              list.appendChild(card);
              list.appendChild(document.createElement("hr"));
            });
            if (list.lastChild && list.lastChild.tagName === "HR") {
              list.removeChild(list.lastChild);
            }

            container.innerHTML = "";
            container.appendChild(list);
          })
          .catch((err) => {
            container.innerHTML = `Failed to load releases: ${err.message}.`;
          });
      })();
    </script>

    <hr />

    <div class="footer">
      <em>Tiny. Quick. Simple. Efficient.</em>
      <sub>Never anything more. Never anything less.</sub>
    </div>
  </body>
</html>
